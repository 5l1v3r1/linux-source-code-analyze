## MINIX文件系统分析

硬盘是用来持久化存储数据的硬件，一般来说，硬盘分为磁盘和固态硬盘，但这里并不会介绍太多关于硬件方面的知识，我们主要详细介绍 `MINIX文件系统` 的原理和现实。

### 什么是文件系统

硬盘属于 `块设备` 硬件，也就是说对硬盘的操作都是通过块来进行的。对于一般的磁盘来说，一个块为512字节（称为扇区）。硬盘就是按照块大小来划分成多个块，每个块都有唯一的编号。

但是对于人类来说，通过块来操作硬盘是非常不方便的，譬如你不知道某个数据块是否已经被使用（当然也可以通过在数据块的第一个字节记录是否已经使用），而且你也不知道这个数据块保存了什么数据。所以这个时候就需要 `文件系统` 来帮助管理这些数据。

那么什么是 `文件系统` 呢？

> 百科上的定义： `文件系统` 是操作系统用于明确磁盘或分区上的文件的方法和数据结构，即在磁盘上组织文件的方法。

前面说过，内存通过内存管理系统进行管理，所以硬盘也需要硬盘管理系统来管理，也就是 `文件系统`。`文件系统` 通过文件的方式来管理硬盘上的数据，并且提供给用户一些简单的API（如 `read()` 和 `write()` 等接口）来操作这些文件。

### 什么是MINIX文件系统

`MINIX文件系统` 是从MINIX操作系统移植到Linux的，其优点是简单清晰，适合用于教学使用。但缺点是过于简单，不适合生产环境使用。不过通过对MINIX文件系统的分析，有助于理解其他复杂的文件系统。

### MINIX文件系统结构

在分析MINIX文件系统实现前，我们先来了解一下MINIX文件系统在硬盘的结构组织，如下图：

![minix_filesystem](https://raw.githubusercontent.com/liexusong/linux-source-code-analyze/master/images/minix_filesystem.png)

可以把硬盘当成一个由多个数据块组成的设备（对于MINIX文件系统一个数据块的大小为1024字节），MINIX文件系统就是组织和管理这些数据块的一种算法。下面来介绍一下上图中各个部分的作用：

* `超级块`：用于记录文件系统的一些信息，比如inode的数量和inode位图占用的数据块数量等。
* `inode位图`：用于记录inode的使用情况，每个位代表inode的使用情况，1表示已经使用，0代表空闲。
* `逻辑块位图`：用于记录逻辑数据块的使用情况，每个位代表一个逻辑数据块的使用情况，1表示已经使用，0代表空闲。
* `inode表`：用于记录所有inode的信息，每个记录代表一个inode。
* `逻辑数据块`：真正保存数据的数据块。

从上面的介绍可以看到，MINIX文件系统的结构比较简单，接下来我们分析一下MINIX文件系统的实现。

### MINIX文件系统实现

